"""
Legal tools for the Legal Expert agent.
Mock implementations for MVP, but with real signatures for LLM understanding.
"""

from langchain_core.tools import tool


@tool
def search_legal_code(query: str | None = None, queries: list[str] | None = None, limit: int | None = 3) -> str:
    """
    Ищет информацию в базе законодательства РФ (ГК РФ, УК РФ, КоАП).
    
    Используй этот инструмент для поиска:
    - Статей законов и кодексов
    - Официальных процедур и требований
    - Правовых норм и регулирований
    - Налогового законодательства
    
    Args:
        query: (Опционально) Одиночный поисковый запрос.
        queries: (Опционально) Список дополнительных запросов для расширенного поиска. Если указан, результаты будут объединены.
        limit: (Опционально) Ограничение количества результатов (игнорируется в текущей версии mock-инструмента).
        
    Returns:
        str: Найденная информация из законодательства РФ
    """
    search_queries = []
    if queries and isinstance(queries, list):
        search_queries.extend(queries)
    if query:
        search_queries.append(query)
    
    # Удаляем дубликаты и пустые
    search_queries = list(set([q for q in search_queries if q]))
    
    if not search_queries:
        return "Ошибка: Не указан поисковый запрос (query или queries)."
        
    all_results = []
    
    # Добавляем метаданные поиска в начало
    metadata = f"SEARCH METADATA:\nQueries: {search_queries}\nLimit: {limit}\n---\n"
    all_results.append(metadata)

    for q in search_queries:
        query_lower = q.lower()
        result_text = ""
        
        if "налог" in query_lower or "оформить" in query_lower or "купля-продажа" in query_lower or "продаж" in query_lower:
             result_text = """Статья 454 ГК РФ: По договору купли-продажи одна сторона (продавец) обязуется передать вещь (товар) в собственность другой стороне (покупателю), а покупатель обязуется принять этот товар и уплатить за него определенную денежную сумму (цену).

Статья 161 ГК РФ: Сделки юридических лиц между собой и с гражданами должны совершаться в простой письменной форме, за исключением сделок, требующих нотариального удостоверения.

При продаже офисного имущества юридическим лицом необходимо:
1. Составить договор купли-продажи в письменной форме
2. Указать точное описание передаваемого имущества
3. Определить цену и порядок расчетов
4. Учесть налоговые последствия (НДС, налог на прибыль)

Налогообложение: согласно ст. 146 НК РФ, реализация товаров облагается НДС."""
    
        elif "административн" in query_lower or "коап" in query_lower:
            result_text = """КоАП РФ содержит составы административных правонарушений и меры ответственности.

Статья 2.1 КоАП РФ: Административным правонарушением признается противоправное, виновное действие (бездействие) физического или юридического лица, за которое настоящим Кодексом или законами субъектов Российской Федерации об административных правонарушениях установлена административная ответственность."""
    
        elif "уголовн" in query_lower or "ук рф" in query_lower:
            result_text = """УК РФ устанавливает основания и принципы уголовной ответственности.

Статья 14 УК РФ: Преступлением признается виновно совершенное общественно опасное деяние, запрещенное настоящим Кодексом под угрозой наказания."""
    
        else:
            result_text = "Информация по данному запросу не найдена в базе законодательства."
            
        all_results.append(f"Query: {q}\nResult:\n{result_text}\n")
    
    return "\n---\n".join(all_results)
